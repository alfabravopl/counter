/*!
* counter.js 0.9
*
* Copyright 2021, BogumiÅ‚ Cenian https://alfabravo.pl @alfabravopl
* Released under the MIT License
*
* Date: 25.10.2021
*/
class abCounter{constructor(t){this.options={element:"[data-to]",time:1e3,delay:10,decimalSeperator:",",thousandSeparator:" ",...t},this.init()}init(){abCounterHelper.getInstance().setLastPosition(document.defaultView.pageYOffset),document.querySelectorAll(this.options.element).forEach(t=>{t.className+=" counter-item",t.counterDataStart=!1,t.setAttribute("data-start","false"),t.setAttribute("data-time",this.options.time),t.setAttribute("data-delay",this.options.delay),t.setAttribute("data-ds",this.options.decimalSeperator),t.setAttribute("data-ts",this.options.thousandSeparator),abCounterHelper.getInstance().addItem(t)}),abCounterHelper.getInstance().setElement(this.options.element),window.addEventListener("scroll",function(){var t=abCounterHelper.getInstance().getLastPosition(),e="bottom";e=t>document.defaultView.pageYOffset?"top":"bottom",abCounterHelper.getInstance().setLastPosition(document.defaultView.pageYOffset),document.querySelectorAll(abCounterHelper.getInstance().getElement()).forEach(t=>{"false"==t.getAttribute("data-start")&&("bottom"==e&&abCounterHelper.getInstance().getLastPosition()+window.innerHeight>t.getAttribute("data-top")||"top"==e&&abCounterHelper.getInstance().getLastPosition()<t.getAttribute("data-bottom"))&&(t.setAttribute("data-start","true"),abCounter.runCounter(t))})}),abCounterHelper.getInstance().setLastPosition(document.defaultView.pageYOffset),document.querySelectorAll(this.options.element).forEach(t=>{abCounterHelper.getInstance().getLastPosition()+window.innerHeight>t.getAttribute("data-top")&&(t.setAttribute("data-start","true"),abCounter.runCounter(t))}),this.calculatePosition()}calculatePosition(){document.querySelectorAll(this.options.element).forEach(t=>{let e=this.getOffsetTop(t),a=e+t.clientHeight;t.setAttribute("data-top",e),t.setAttribute("data-bottom",a)})}getOffsetTop(t){let e=t.getBoundingClientRect(),a=t.ownerDocument.defaultView;return e.top+a.pageYOffset}static runCounter(t){var e=[],a=parseInt(t.getAttribute("data-time"))/parseInt(t.getAttribute("data-delay")),n=t.getAttribute("data-to"),s=t.getAttribute("data-ts"),o=t.getAttribute("data-ds"),r=new RegExp("[0-9]+"+s+"[0-9]+").test(n),i=new RegExp(s,"g");n=n.replace(i,"");var u=new RegExp("^[0-9]+"+o+"[0-9]+$").test(n),l=u?(n.split(o)[1]||[]).length:0;if(u&&"."!=o){var d=new RegExp(o,"g");n=n.replace(d,".")}for(var c=a;c>=1;c--){var p=parseInt(n/a*c);if(u&&(p=parseFloat(n/a*c).toFixed(l)),r)for(;/(\d+)(\d{3})/.test(p.toString());)p=p.toString().replace(/(\d+)(\d{3})/,"$1"+s+"$2");u&&"."!=o&&(p=p.replace(".",o)),e.unshift(p)}t.dataset.nums=JSON.stringify(e),t.innerText="0",setTimeout(abCounterHelper.getInstance().doCounter,parseInt(t.getAttribute("data-delay")),t)}}class abCounterHelper{constructor(){return abCounterHelper.instance||(this.lastPosition=0,this.scrollDirection="bottom",this.items=[],this.elementSelector="",window.addEventListener("resize",function(){document.querySelectorAll(abCounterHelper.getElement()).forEach(t=>{let e=this.getOffsetTop(t),a=e+t.clientHeight;t.setAttribute("data-top",e),t.setAttribute("data-bottom",a)})}),abCounterHelper.instance=this),abCounterHelper.instance}static getInstance(){return new abCounterHelper}setLastPosition(t){this.lastPosition=t}getLastPosition(){return this.lastPosition}addItem(t){this.items.push(t)}getItems(){return this.items}setElement(t){this.elementSelector.length>0&&(this.elementSelector+=","),this.elementSelector+=t}getElement(){return this.elementSelector}doCounter(t){var e=JSON.parse(t.dataset.nums);t.innerText=e.shift(),t.dataset.nums=JSON.stringify(e),e.length?setTimeout(abCounterHelper.getInstance().doCounter,parseInt(t.getAttribute("data-delay")),t):(delete t.dataset.nums,delete t.dataset.counterFunc)}}